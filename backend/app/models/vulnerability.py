# backend/app/models/vulnerability.py
from sqlalchemy import Column, Integer, String, Text, DateTime, Table, ForeignKey
from sqlalchemy.orm import relationship
from app.database import Base
from app.models.relations import vulnerability_platform
from app.models.cve_description import CveDescription


class Vulnerability(Base):
    __tablename__ = "vulnerabilities"

    id = Column(Integer, primary_key=True, index=True)
    cve_id = Column(String, unique=True, index=True)
    source_identifier = Column(String, nullable=True)
    published = Column(DateTime, nullable=True)
    last_modified = Column(DateTime, nullable=True)
    status = Column(String, nullable=True)
    cvss_score = Column(String, nullable=True)
    cvss_vector = Column(String, nullable=True)
    severity = Column(String, nullable=True)
    cwe = Column(String, nullable=True)

    platforms = relationship("Platform", secondary=vulnerability_platform, back_populates="vulnerabilities")
    descriptions = relationship("CveDescription", back_populates="vulnerability", cascade="all, delete-orphan")
    references = relationship("Reference", back_populates="vulnerability", cascade="all, delete-orphan")


