# backend/app/schemas/vulnerability.py
from pydantic import BaseModel
from typing import Optional
from datetime import datetime
from typing import List
from app.schemas.cve_description import CveDescriptionResponse, CveDescriptionCreate

class VulnerabilityCreate(BaseModel):
    cve_id: str
    source_identifier: Optional[str] = None
    published: Optional[datetime] = None
    last_modified: Optional[datetime] = None
    status: Optional[str] = None
    cwe: Optional[str] = None
    cvss_version: Optional[str] = None
    score: Optional[str] = None
    vector: Optional[str] = None
    severity: Optional[str] = None

    exploitability_score: Optional[float] = None
    impact_score: Optional[float] = None
    user_interaction_required: Optional[bool] = None
    obtain_all_privileges: Optional[bool] = None
    obtain_user_privileges: Optional[bool] = None
    obtain_other_privileges: Optional[bool] = None

    attack_vector: Optional[str] = None
    attack_complexity: Optional[str] = None
    privileges_required: Optional[str] = None
    user_interaction: Optional[str] = None
    scope: Optional[str] = None
    confidentiality_impact: Optional[str] = None
    integrity_impact: Optional[str] = None
    availability_impact: Optional[str] = None

    access_vector: Optional[str] = None
    access_complexity: Optional[str] = None
    authentication: Optional[str] = None
    descriptions: Optional[List[CveDescriptionCreate]] = None


class VulnerabilityUpdate(BaseModel):
    source_identifier: Optional[str] = None
    published: Optional[datetime] = None
    last_modified: Optional[datetime] = None
    status: Optional[str] = None
    cvss_score: Optional[str] = None
    cvss_vector: Optional[str] = None
    severity: Optional[str] = None
    cvss_version: Optional[str] = None
    cwe: Optional[str] = None

class VulnerabilityResponse(VulnerabilityCreate):
    id: int

class VulnerabilityReferenceSchema(BaseModel):
    url: str

    class Config:
        orm_mode = True

class DetailedVulnerabilityResponse(BaseModel):
    cve_id: str
    source_identifier: Optional[str]
    published: Optional[datetime]
    status: Optional[str]

    descripcion: Optional[str]  # traducción al español
    references: List[VulnerabilityReferenceSchema] = []
    cwe: List[str] = []

    cvss_version: Optional[str]
    score: Optional[str]
    vector: Optional[str]
    severity: Optional[str]

    exploitability_score: Optional[float]
    impact_score: Optional[float]
    user_interaction_required: Optional[bool]
    obtain_all_privileges: Optional[bool]
    obtain_user_privileges: Optional[bool]
    obtain_other_privileges: Optional[bool]

    attack_vector: Optional[str]
    attack_complexity: Optional[str]
    privileges_required: Optional[str]
    user_interaction: Optional[str]
    scope: Optional[str]
    confidentiality_impact: Optional[str]
    integrity_impact: Optional[str]
    availability_impact: Optional[str]

    access_vector: Optional[str]
    access_complexity: Optional[str]
    authentication: Optional[str]

    class Config:
        orm_mode = True